/**
 * Copyright (c) 2016 Sqreen. All Rights Reserved.
 * Please refer to our terms for more information: https://www.sqreen.io/terms.html
 */
'use strict';
const Code = require('code');
const Lab = require('lab');
const lab = exports.lab = Lab.script();

const describe = lab.describe;
const it = lab.it;
const expect = Code.expect;

const TemplateEngines = require('../../../lib/instrumentation/templateEngines');
const Director = require('../../../lib/instrumentation/sqreenDirector');

describe('TemplateEngines', () => {

    it('should be enabled by the presence of jade', { plan: 5 }, (done) => {

        TemplateEngines.hook('poney');
        expect(Director._getInstrumented().sqreen).to.not.exist();
        expect(process.__sqreen_escape).to.not.exist();
        TemplateEngines.hook('jade');
        TemplateEngines.hook('jade');
        expect(Director._getInstrumented().sqreen).to.exist();
        expect(Director._getInstrumented().sqreen[''][''].__sqreen_escape).to.exist();
        expect(process.__sqreen_escape('1')).to.equal('1');
        done();
    });
});
