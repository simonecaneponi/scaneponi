/**
 * Copyright (c) 2016 Sqreen. All Rights Reserved.
 * Please refer to our terms for more information: https://www.sqreen.io/terms.html
 */
'use strict';
const Code = require('code');
const Lab = require('lab');
const lab = exports.lab = Lab.script();

const describe = lab.describe;
const it = lab.it;
const expect = Code.expect;

const InsertSqreenEscapeJade = require('../../../../lib/rules/rules-callback/insertSqreenEscapeJade');

describe('insertSqreenEscapeJade', () => {

    describe('pre', () => {

        it('should get the callback and execute it', { plan: 4 }, (done) => {

            delete process.__sqreen_escape;
            InsertSqreenEscapeJade.getCbs();
            const cb = InsertSqreenEscapeJade.getCbs();
            const pre = cb.pre;

            const args0 = {};
            pre(args0);
            expect(args0).to.equal({});

            const arg1 = { '0': '__sqreen_escape()' };
            pre(arg1);
            expect(arg1[0]).to.equal('__sqreen_escape()');

            const arg2 = { '0': 'jade.escape(t1)' };
            pre(arg2);
            expect(arg2[0]).to.equal('jade.escape(t1)');

            const arg3 = { '0': 't1' };
            pre(arg3);
            expect(arg3[0]).to.equal('process.__sqreen_escape(t1)');

            done();
        });
    });
});
