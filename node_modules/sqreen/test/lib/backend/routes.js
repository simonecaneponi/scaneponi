/**
 * Copyright (c) 2016 Sqreen. All Rights Reserved.
 * Please refer to our terms for more information: https://www.sqreen.io/terms.html
 */
'use strict';
const Code = require('code');
const Lab = require('lab');
const lab = exports.lab = Lab.script();

const after = lab.after;

const describe = lab.describe;
const it = lab.it;
const expect = Code.expect;

const Proxyquire = require('proxyquire');

after((done) => {

    delete process.env.SQREEN_TOKEN;
    delete process.env.SQREEN_URL;
    done();
});

describe('BackEnd', () => {

    describe('routes', () => {

        it('should provide routes even when no config is defined', { plan: 1 }, (done) => {

            const Routes = Proxyquire('../../../lib/backend/routes', {
                '../config': {
                    getConfig: () => null
                }
            });

            expect(Routes.attack).to.includes(('https://back.sqreen.io'));
            done();
        });

        it('should provide routes even when a config is defined', { plan: 1 }, (done) => {

            const Routes = Proxyquire('../../../lib/backend/routes', {
                '../config': {
                    getConfig: () => ({ url: 'http://none.sqreen.io' })
                }
            });

            expect(Routes.attack).to.includes('http://none.sqreen.io');
            done();
        });
    });
});

